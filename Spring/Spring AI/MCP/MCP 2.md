跳过主内容 [https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#main] \n\nSpring博客 [https://spring.io/blog]\n======================================\n\n[所有文章](https://spring.io/blog)\n[工程](https://spring.io/blog/category/engineering)\n[版本发布](https://spring.io/blog/category/releases)\n[新闻与活动](https://spring.io/blog/category/news)\nRSS订阅源\n[所有文章](https://spring.io/blog.atom)\n[工程](https://spring.io/blog/category/engineering.atom)\n[版本发布](https://spring.io/blog/category/releases.atom)\n[新闻与活动](https://spring.io/blog/category/news.atom)\n\n连接AI到万物：Spring AI的MCP启动器\n============================================================\n\n[工程](https://spring.io/blog/category/engineering) | [Christian Tzolov](https://spring.io/team/tzolov) | 2025年9月16日 | [...]\n\n![](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250901/spring-ai-mcp-annotations-banner-3.png)\n\n模型上下文协议（MCP）标准化了AI应用与外部工具和资源的交互方式。Spring早期作为关键贡献者加入了MCP生态系统，帮助开发和维护作为Java版MCP实现基础的[官方MCP Java SDK](https://modelcontextprotocol.io/sdk/java/mcp-overview)。基于此贡献，Spring AI通过专用[启动器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-overview.html#_spring_ai_mcp_integration)和[MCP Java注解](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-annotations-overview.html)全面拥抱MCP，前所未有地简化了构建能与外部系统无缝连接的复杂AI应用。\n\n本篇博客介绍MCP核心组件，并演示使用Spring AI构建MCP服务器和客户端，展示基础与高级功能。完整源码见：[MCP天气示例](https://github.com/tzolov/spring-ai-mcp-blogpost)。\n\n> **注意：** 本内容仅适用于Spring AI `1.1.0-SNAPSHOT`或Spring `AI 1.1.0-M1+`版本。\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#what-is-the-model-context-protocol)\n什么是模型上下文协议？\n-------------------------------------------------------------------------------------------------------------------------------------\n\n[模型上下文协议（MCP）](https://modelcontextprotocol.org/docs/concepts/architecture)是一种标准化协议，使AI模型能以结构化方式与外部工具和资源交互。可将其视为AI模型与现实世界间的桥梁——允许它们通过统一接口访问数据库、API、文件系统等外部服务。\n\n### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#mcp-client-server-architecture)\nMCP客户端-服务器架构\n\n![isolated](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-CLIENT-SERVER-ARCHITECTURE.svg)\n\n模型上下文协议采用客户端-服务器架构确保关注点分离。MCP服务器从第三方服务暴露特定能力（工具、资源、提示）。主机应用实例化MCP客户端以与特定MCP服务器通信，每个客户端处理与单台服务器的直接通信。\n\n主机是用户交互的AI应用，客户端是实现服务器连接的协议级组件。\n\nMCP协议确保客户端与服务器间实现完全、语言无关的互操作性。您可以使用Java、Python或TypeScript编写的客户端与任何语言的服务器通信，反之亦然。\n\n此架构在客户端与服务器端开发间建立了明确边界和责任，自然形成两个不同的开发者社区：\n\n**AI应用/主机开发者**\n\n负责协调多个MCP服务器（通过MCP客户端连接）并与AI模型集成。AI开发者构建的AI应用能够：\n*   使用MCP客户端消费多个MCP服务器的能力\n*   处理AI模型集成与提示工程\n*   管理会话上下文与用户交互\n*   协调跨服务的复杂工作流\n*   专注于打造出色的用户体验\n\n**MCP服务器（提供者）开发者**\n\n专注于将第三方服务（数据库、文件系统、外部API）的特定能力作为MCP服务器暴露。服务器开发者创建的服务器能够：\n*   封装第三方服务和API\n*   通过标准化MCP原语（工具、资源、提示）暴露服务能力\n*   处理特定服务的认证与授权\n\n这种分离确保服务器开发者可专注于封装其领域特定服务，无需担心AI协调问题；而AI应用开发者能利用现有MCP服务器，无需理解每个第三方服务的细节。\n\n分工意味着数据库专家可在不了解LLM提示的情况下创建PostgreSQL的MCP服务器，而AI应用开发者可在不懂SQL内部原理的情况下使用该服务器。MCP协议成为两者间的通用语言。\n\n**Spring AI**通过[MCP客户端](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-client-boot-starter-docs.html)和[MCP服务器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-server-boot-starter-docs.html)启动器拥抱此架构。这意味着Spring开发者可参与MCP生态的双边——构建消费MCP服务器的AI应用，并创建将基于Spring的服务暴露给更广泛AI社区的MCP服务器。\n\n### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#mcp-features)\nMCP特性\n\n![MCP功能](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-FEATURES.svg)\n\nMCP在客户端与服务器间共享，提供丰富特性集以实现AI应用与外部服务的无缝通信：\n*   暴露AI模型可调用的[工具](https://modelcontextprotocol.io/specification/2025-06-18/server/tools)\n*   与AI应用共享[资源](https://modelcontextprotocol.io/specification/2025-06-18/server/resources)和数据\n*   为一致交互提供[提示](https://modelcontextprotocol.io/specification/2025-06-18/server/prompts)模板\n*   为提示和资源URI提供参数[自动补全](https://modelcontextprotocol.io/specification/2025-06-18/server/utilities/completion)建议\n*   处理实时通知和[进度](https://modelcontextprotocol.io/specification/2025-06-18/basic/utilities/progress)更新\n*   支持客户端[采样](https://modelcontextprotocol.io/specification/2025-06-18/client/sampling)、[启发](https://modelcontextprotocol.io/specification/2025-06-18/client/elicitation)、[结构化日志](https://modelcontextprotocol.io/specification/2025-06-18/server/utilities/logging)和[进度追踪](https://modelcontextprotocol.io/specification/2025-06-18/basic/utilities/progress)\n*   支持多种传输协议：[STDIO](http://localhost:3000/specification/2025-06-18/basic/transports#stdio)、[可流式HTTP](http://localhost:3000/specification/2025-06-18/basic/transports#streamable-http)和[SSE](http://localhost:3000/specification/2024-11-05/basic/transports#http-with-sse)\n\n> **重要提示：** 与其他MCP特性（如提示和资源）不同，工具由LLM拥有。由LLM（而非主机）决定是否、何时及以何种顺序调用工具，主机仅控制向LLM提供哪些工具描述。\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#build-an-mcp-server)\n构建MCP服务器\n------------------------------------------------------------------------------------------------------\n\n让我们构建一个[可流式HTTP MCP服务器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-streamable-http-server-boot-starter-docs.html)以提供实时天气预报信息。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#spring-boot-server-application)\nSpring Boot服务器应用\n\n创建新的（`mcp-weather-server`）Spring Boot应用：\n\n```java\n@SpringBootApplication\npublic class McpServerApplication {\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(McpServerApplication.class, args);\n\t}\n}\n```\n\n添加Spring AI MCP服务器依赖：\n\n```xml\n<dependency>\n    <groupId>org.springframework.ai</groupId>\n    <artifactId>spring-ai-starter-mcp-server-webmvc</artifactId>\n</dependency>\n```\n\n查看可用服务器[依赖选项](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-server-boot-starter-docs.html#_mcp_server_boot_starters)。\n\n在`application.properties`中启用[可流式HTTP](https://modelcontextprotocol.io/specification/2025-06-18/basic/transports#streamable-http)服务器传输：\n\n```\nspring.ai.mcp.server.protocol=STREAMABLE\n```\n\n您可使用`STREAMABLE`、`STATELESS`或`SSE`传输启动服务器。启用`STDIO`传输需设置`spring.ai.mcp.server.stdio=true`。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#weather-service)\n天气服务\n\n利用免费的[天气REST API](https://open-meteo.com/)构建通过坐标位置检索天气预报的服务。\n\n添加@McpTool和@McpToolParam注解将`getTemperature`方法注册为MCP服务器工具：\n\n```java\n@Service\npublic class WeatherService {\n\n\tpublic record WeatherResponse(Current current) {\n\t\tpublic record Current(LocalDateTime time, int interval, double temperature_2m) {}\n\t}\n\n\t@McpTool(description = \"获取特定位置的温度（摄氏度）\")\n\tpublic WeatherResponse getTemperature(\n      @McpToolParam(description = \"位置纬度\") double latitude,\n      @McpToolParam(description = \"位置经度\") double longitude) {\n\n\t\treturn RestClient.create()\n\t\t\t\t.get()\n\t\t\t\t.uri(\"https://api.open-meteo.com/v1/forecast?latitude={latitude}&longitude={longitude}&current=temperature_2m\",\n\t\t\t\t\t\tlatitude, longitude)\n\t\t\t\t.retrieve()\n\t\t\t\t.body(WeatherResponse.class);\n\t}\n}\n```\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#build--run)\n构建与运行\n\n```bash\n./mvnw clean install -DskipTests\n\njava -jar target/mcp-weather-server-0.0.1-SNAPSHOT.jar\n```\n\n此命令在端口`8080`启动mcp-weather-server。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#using-the-mcp-server)\n使用MCP服务器\n\nMCP天气服务器运行后，您可使用各种MCP兼容的客户端应用与其交互：\n\n**[MCP检查器](https://modelcontextprotocol.io/legacy/tools/inspector)**\n\nMCP检查器是用于测试和调试MCP服务器的交互式开发者工具。运行以下命令启动检查器：\n\n```bash\nnpx @modelcontextprotocol/inspector\n```\n\n在浏览器UI中，将传输类型设为`Streamable HTTP`，URL设为`http://localhost:8080/mcp`。点击`连接`建立连接，随后列出工具并运行getTemperature。\n\n![MCP功能](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-INSPECTOR.png)\n\n**[MCP Java SDK](https://modelcontextprotocol.io/sdk/java/mcp-client#client-features)**\n\n使用MCP Java SDK客户端以编程方式连接服务器：\n\n```java\nvar client = McpClient.sync(\nHttpClientStreamableHttpTransport\n\t.builder(\"http://localhost:8080\").build())\n.build();\n\nclient.initialize();\n\nCallToolResult weather = client.callTool(\n\tnew CallToolRequest(\"getTemperature\", \n\t\t\tMap.of(\"latitude\", \"47.6062\", \n\t\t\t\t\t\"longitude\", \"-122.3321\")));\n```\n\n**其他MCP兼容的AI应用/SDK**\n\n将您的MCP服务器连接到热门AI应用：\n*   [Cline](https://docs.cline.bot/mcp/mcp-overview) - VS Code的AI编码助手\n*   [VS Code MCP](https://code.visualstudio.com/docs/copilot/customization/mcp-servers) - GitHub Copilot的MCP集成\n*   [Cursor MCP](https://docs.cursor.com/en/context/mcp)\n*   [非Java MCP客户端](https://modelcontextprotocol.io/docs/develop/build-client) - 使用其他（非Java）SDK构建MCP客户端\n*   ...\n\n**[Claude桌面版](https://claude.ai/download)**\n\n要通过本地[STDIO传输](https://modelcontextprotocol.io/specification/2025-06-18/basic/transports#stdio)与Claude桌面版集成，在Claude桌面版设置中添加以下配置：\n\n```json\n{\n \"mcpServers\": {\n  \"spring-ai-mcp-weather\": {\n  \"command\": \"java\",\n  \"args\": [\\\n\t\"-Dspring.ai.mcp.server.stdio=true\",\\\n\t\"-Dspring.main.web-application-type=none\",\\\n\t\"-Dlogging.pattern.console=\",\\\n\t\"-jar\",\\\n\t\"/path/to/mcp-weather-server-0.0.1.jar\"]\n  }\n }\n}\n```\n\n_将`/absolute/path/to/`替换为您构建的JAR文件的实际路径。_\n\n遵循[Claude桌面版的MCP服务器安装指南](https://www.anthropic.com/engineering/desktop-extensions)获取进一步指导。Claude桌面版免费版不支持采样！\n\n![MCP Claude桌面版](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-CLAUDE-DESKTOP.png)\n\n### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#advanced-server-features)\n高级服务器功能\n\n让我们扩展MCP天气服务器以演示日志记录、进度追踪和采样等高级MCP功能。这些功能支持服务器与客户端间的丰富交互：\n*   **日志记录**：向连接的客户端发送结构化日志消息用于调试和监控\n*   **进度追踪**：为长时间运行的操作报告实时进度更新\n*   **采样**：请求客户端的LLM基于服务器数据生成内容\n\n在此增强版中，我们的天气服务器将向客户端记录操作以实现透明性，在获取和处理天气数据时报告进度，并请求客户端的LLM生成关于天气预报的史诗诗歌。\n\n以下是更新后的服务器实现：\n\n```java\n@Service\npublic class WeatherService {\n\n\tpublic record WeatherResponse(Current current) {\n\t\tpublic record Current(LocalDateTime time, int interval, double temperature_2m) {}\n\t}\n\n\t@McpTool(description = \"获取特定位置的温度（摄氏度）\")\n\tpublic String getTemperature(\n\t\t\tMcpSyncServerExchange exchange, // (1)\n\t\t\t@McpToolParam(description = \"位置纬度\") double latitude,\n\t\t\t@McpToolParam(description = \"位置经度\") double longitude,\n\t\t\t@McpProgressToken String progressToken) { // (2)\n\n\t\texchange.loggingNotification(LoggingMessageNotification.builder() // (3)\n\t\t\t.level(LoggingLevel.DEBUG)\n\t\t\t.data(\"调用getTemperature工具，纬度：\" + latitude + \"，经度：\" + longitude)\n\t\t\t.meta(Map.of()) // 非空元数据作为bug的临时解决方案：...\n\t\t\t.build());\n\n\t\tWeatherResponse weatherResponse = RestClient.create()\n\t\t\t\t.get()\n\t\t\t\t.uri(\"https://api.open-meteo.com/v1/forecast?latitude={latitude}&longitude={longitude}&current=temperature_2m\",\n\t\t\t\t\t\tlatitude, longitude)\n\t\t\t\t.retrieve()\n\t\t\t\t.body(WeatherResponse.class);\n\t\t\n\n\t\tString epicPoem = \"MCP客户端未提供采样功能。\";\n\n\t\tif (exchange.getClientCapabilities().sampling() != null) {\n\t\t\t// 50%进度\n\t\t\texchange.progressNotification(new ProgressNotification(progressToken, 0.5, 1.0, \"开始采样\"));\t// (4)\n\n\t\t\tString samplingMessage = \"\"\"\n\t\t\t\t\t天气预报（温度单位为摄氏度）：%s。\n\t\t\t\t\t位于纬度：%s，经度：%s的位置。\n\t\t\t\t\t请用莎士比亚风格创作一首关于此预报的史诗诗歌。\n\t\t\t\t\t\"\"\".formatted(weatherResponse.current().temperature_2m(), latitude, longitude);\n\n\t\t\tCreateMessageResult samplingResponse = exchange.createMessage(CreateMessageRequest.builder()\n\t\t\t\t\t.systemPrompt(\"您是一位诗人！\")\n\t\t\t\t\t.messages(List.of(new SamplingMessage(Role.USER, new TextContent(samplingMessage))))\n\t\t\t\t\t.build()); // (5)\n\n\t\t\tepicPoem = ((TextContent) samplingResponse.content()).text();\n\t\t}\n\t\t\n\t\t// 100%进度\n\t\texchange.progressNotification(new ProgressNotification(progressToken, 1.0, 1.0, \"任务完成\"));\n\n\t\treturn \"\"\"\n\t\t\t气象诗歌：%s\n\t\t\t关于天气：%s°C，位置：(%.4f, %.4f)\n\t\t\t\"\"\".formatted(epicPoem, weatherResponse.current().temperature_2m(), latitude, longitude);\n  }\n}\n```\n\n1.  **McpSyncServerExchange** - `exchange`参数提供访问服务器-客户端通信能力，允许服务器向客户端发送通知和请求。\n2.  **@ProgressToken** - `progressToken`参数启用进度追踪。客户端提供此令牌，服务器用它发送进度更新。\n3.  **日志通知** - 向客户端发送结构化日志消息用于调试和监控。\n4.  **进度更新** - 向客户端报告操作进度（此处为50%）及描述性消息。\n\n![MCP功能](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-SAMPLING-SEQ.svg)\n\n5.  **采样功能** - 最强大的功能：服务器可请求客户端的LLM生成内容。\n\n这允许服务器利用客户端的AI能力，创建双向AI交互模式。\n\n增强版天气服务现在不仅返回天气数据，还返回关于预报的创意诗歌，展示了MCP服务器与AI模型间的强大协同作用。\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#build-an-mcp-client)\n构建MCP客户端\n------------------------------------------------------------------------------------------------------\n\n让我们构建一个使用LLM并通过MCP客户端连接MCP服务器的AI应用。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#client-configuration)\n客户端配置\n\n创建新的Spring Boot项目（`mcp-weather-client`）并添加以下依赖：\n\n```xml\n<dependency>\n  <groupId>org.springframework.ai</groupId>\n  <artifactId>spring-ai-starter-mcp-client</artifactId>\n</dependency>\n\n<dependency>\n  <groupId>org.springframework.ai</groupId>\n  <artifactId>spring-ai-starter-model-anthropic</artifactId>\n</dependency>\n```\n\n查看[可用依赖选项](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-client-boot-starter-docs.html#_starters)以配置不同传输机制。\n\n在`application.yml`中配置到MCP服务器的连接：\n\n```yaml\nspring:\n  main:\n    web-application-type: none\n\n  ai:\n    # 设置Anthropic API账户凭证\n    anthropic:\n      api-key: ${ANTHROPIC_API_KEY}\n\n    # 使用可流式HTTP客户端传输连接MCP天气服务器\n    mcp:\n      client:\n        streamable-http:\n          connections:\n            my-weather-server:\n              url: http://localhost:8080\n```\n\n注意配置中为服务器连接分配了`my-weather-server`名称。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#spring-boot-client-application)\nSpring Boot客户端应用\n\n创建使用`ChatClient`连接LLM和MCP天气服务器的客户端应用：\n\n```java\n@SpringBootApplication\npublic class McpClientApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(McpClientApplication.class, args).close(); // (1)\n\t}\n\n\t@Bean\n\tpublic ChatClient chatClient(ChatClient.Builder chatClientBuilder) { // (2)\n\t\treturn chatClientBuilder.build();\n\t}\n\n\tString userPrompt = \"\"\"\n\t\t立即查看阿姆斯特丹的天气并展示创意回复！\n\t\t请整合来自所有LLM提供商的创意回复。\n\t\t\"\"\";\n\n\t@Bean\n\tpublic CommandLineRunner predefinedQuestions(ChatClient chatClient, ToolCallbackProvider mcpToolProvider) { // (3)\n\t\treturn args -> System.out.println(\n\t\t\tchatClient.prompt(userPrompt) // (4)\n\t\t\t\t.toolContext(Map.of(\"progressToken\", \"token-\" + new Random().nextInt())) // (5)\n\t\t\t\t.toolCallbacks(mcpToolProvider) // (6)\n\t\t\t\t.call()\n\t\t\t\t.content());\n\t}\n}\n```\n\n1.  **应用生命周期管理** - 应用启动后执行天气查询，显示结果，然后干净退出。\n2.  **ChatClient配置** - 使用Spring AI自动配置的构建器创建[ChatClient](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/chatclient.html) bean。构建器自动填充：\n    *   AI模型配置（本文使用Anthropic Claude）\n    *   来自application.properties的默认设置和配置\n3.  **CommandLineRunner** - 在应用上下文完全加载后自动运行。它注入配置好的ChatClient用于AI模型交互，以及包含所有已连接服务器注册MCP工具的`ToolCallbackProvider`。\n4.  **AI提示** - 指示AI模型获取阿姆斯特丹当前天气。AI模型基于提示自动发现并调用适当的MCP工具。\n5.  **进度令牌** - 使用`toolContext`传递唯一的`progressToken`给带有@McpProgressToken参数的MCP工具。\n6.  **MCP工具集成** - 此关键行将ChatClient连接到所有可用MCP工具：\n    *   `mcpToolProvider`由Spring AI的MCP客户端启动器自动配置\n    *   包含来自已连接MCP服务器的所有工具（通过`spring.ai.mcp.client.*.connections.*`配置）\n    *   AI模型可在对话中自动发现并调用这些工具\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#client-mcp-handlers)\n客户端MCP处理器\n\n创建服务类处理来自服务器的MCP通知和请求。这些处理器是我们上述实现的高级服务器功能的**客户端对应部分**，支持MCP服务器与客户端间的双向通信：\n\n```java\n@Service\npublic class McpClientHandlers {\n\n\tprivate static final Logger logger = LoggerFactory.getLogger(McpClientHandlers.class);\n\n\tprivate final ChatClient chatClient;\n\n\tpublic McpClientHandlers(@Lazy ChatClient chatClient) { // Lazy避免循环依赖\n\t\tthis.chatClient = chatClient;\n\t}\n\n\t@McpProgress(clients = \"my-weather-server\") // (1)\n\tpublic void progressHandler(ProgressNotification progressNotification) {\n\t\tlogger.info(\"MCP进度：[{}] 进度：{} 总计：{} 消息：{}\",\n\t\t\t\tprogressNotification.progressToken(), progressNotification.progress(),\n\t\t\t\tprogressNotification.total(), progressNotification.message());\n\t}\n\n\t@McpLogging(clients = \"my-weather-server\")\n\tpublic void loggingHandler(LoggingMessageNotification loggingMessage) {\n\t\tlogger.info(\"MCP日志：[{}] {}\", loggingMessage.level(), loggingMessage.data());\n\t}\n\n\t@McpSampling(clients = \"my-weather-server\")\n\tpublic CreateMessageResult samplingHandler(CreateMessageRequest llmRequest) {\n\n\t\tlogger.info(\"MCP采样：{}\", llmRequest);\n\n\t\tString llmResponse = chatClient\n\t\t\t\t.prompt()\n\t\t\t\t.system(llmRequest.systemPrompt())\n\t\t\t\t.user(((TextContent) llmRequest.messages().get(0).content()).text())\n\t\t\t\t.call()\n\t\t\t\t.content();\n\n\t\treturn CreateMessageResult.builder().content(new TextContent(llmResponse)).build();\n\t}\n}\n```\n\n##### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#understanding-the-handler-components)\n理解处理器组件：\n\n1.  **进度处理器** - 接收来自服务器长时间运行操作的实时进度更新。当服务器调用`exchange.progressNotification(...)`时触发。例如天气服务器在开始采样时发送50%进度，完成后发送100%进度。常用于显示进度条、更新UI状态或记录操作进度。\n2.  **日志处理器** - 接收来自服务器的结构化日志消息用于调试和监控。当服务器调用`exchange.loggingNotification(...)`时触发。例如天气服务器记录\"调用getTemperature工具，纬度：X，经度：Y\"。用于调试服务器操作、审计跟踪或监控仪表板。\n3.  **采样处理器** - **最强大的功能**。使服务器能请求从客户端的LLM生成AI内容。用于双向AI交互、创意内容生成、动态响应。当服务器调用`exchange.createMessage(...)`并检查采样能力时触发。执行流程如下：\n    *   若客户端支持采样，则请求关于天气的诗歌\n    *   客户端处理器接收请求，使用其ChatClient与LLM交互生成诗歌\n    *   生成的诗歌返回给服务器并融入最终工具响应\n\n##### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#key-design-patterns)\n关键设计模式：\n\n*   **基于注解的路由**：`clients = \"my-weather-server\"`属性确保处理器仅处理来自配置中特定MCP服务器连接的通知：`spring.ai.mcp.client.streamable-http.connections.[my-weather-server].url`。\n    若应用连接多个MCP服务器，使用`clients`属性将每个处理器分配给对应的MCP客户端：\n    ```java\n    @McpProgress(clients = {\"weather-server\", \"database-server\"})  // 处理来自多个服务器的进度\n    public void multiServerProgressHandler(ProgressNotification notification) {\n     // 处理来自两个服务器的进度\n    }\n    \n    @McpSampling(clients = \"specialized-ai-server\")  // 处理特定服务器的采样\n    public CreateMessageResult specializedSamplingHandler(CreateMessageRequest request) {\n     // 处理来自专用AI服务器的采样请求\n    }\n    ```\n*   ChatClient上的**@Lazy**注解防止当ChatClient也依赖MCP组件时可能出现的循环依赖问题。\n*   **双向AI通信**：采样处理器创建了强大的模式：\n    *   服务器（领域专家）可利用客户端的AI能力\n    *   客户端的LLM基于服务器提供的上下文生成创意内容\n    *   这实现了超越简单工具调用的复杂AI间交互\n    此架构使MCP客户端成为服务器操作中的**响应式参与者**，支持复杂交互而非仅被动消费工具。\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#multiple-mcp-servers)\n多个MCP服务器\n\n使用不同传输方式连接多个MCP服务器。以下是如何添加[Brave搜索MCP服务器](https://github.com/brave/brave-search-mcp-server)用于网络搜索，与您的天气服务器并列：\n\n![MCP演示](https://raw.githubusercontent.com/spring-io/spring-io-static/refs/heads/main/blog/tzolov/20250911/MCP-DEMO-APP-2.svg)\n\n```yaml\nspring:\n  ai:\n    anthropic:\n      api-key: ${ANTHROPIC_API_KEY}\n    mcp:\n      client:\n        streamable-http:\n          connections:\n            my-weather-server:\n              url: http://localhost:8080\n        stdio:\n          connections:\n            brave-search:\n              command: npx\n              args: [\"-y\", \\\n\t\t\t\"@modelcontextprotocol/server-brave-search\"]\n```\n\n它使用STDIO客户端传输。现在您的LLM可在单次提示中组合天气数据和网络搜索：\n\n```java\nString userPrompt = \"\"\"\n\t查看阿姆斯特丹天气并展示创意回复！\n\t请整合所有创意回复。\n\t\n\t然后在线搜索寻找诗歌出版商并列出前3名。\n\t\"\"\";\n```\n\n#### [](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#build--run-1)\n构建与运行\n\n确保您的MCP天气服务器已启动运行。\n然后构建并启动客户端：\n\n```bash\n./mvnw clean install -DskipTests\n\njava -jar target/mcp-weather-client-0.0.1-SNAPSHOT.jar\n```\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#conclusion)\n结论\n------------------------------------------------------------------------------------\n\nSpring成熟的开发模型与MCP标准化协议的结合，为下一代AI应用创建了强大基础。无论您构建聊天机器人、数据分析工具还是开发助手，Spring AI的MCP支持都提供了所需的基础模块。\n\n本篇介绍涵盖了基本MCP概念，并演示了如何使用Spring AI的启动器构建具备基础工具功能的MCP服务器和客户端。但MCP生态系统提供了更复杂的能力，我们将在后续博客中探索：\n*   **Java MCP注解深度解析**：学习利用Spring AI基于注解的方法创建更可维护、声明式的MCP实现，包括高级注解模式和最佳实践。\n*   **超越工具——提示、资源与补全**：探索如何实现完整的MCP能力，包括共享提示模板、动态资源供应和智能自动补全功能，使您的MCP服务器更用户友好和强大。\n*   **授权支持——保护MCP服务器**：用OAuth 2保护您的MCP服务器，确保仅授权用户可访问工具、资源和其他能力。为MCP客户端添加授权支持，使其能获取OAuth 2令牌以通过安全MCP服务器认证。\n\n准备好开始了吗？查看[示例应用](https://github.com/spring-projects/spring-ai-examples/tree/main/model-context-protocol)并探索Spring AI与MCP集成的全部潜力。\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#additional-resources)\n附加资源\n--------------------------------------------------------------------------------------------------------\n*   [模型上下文协议规范](https://modelcontextprotocol.io/specification/) - 官方MCP协议文档\n*   [MCP Java SDK](https://modelcontextprotocol.io/sdk/java/mcp-overview) - MCP Java SDK文档\n*   [MCP天气示例代码](https://github.com/tzolov/spring-ai-mcp-blogpost)\n*   [Spring AI MCP概览](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-overview.html) - 完整的架构概览和概念\n    *   [MCP客户端启动器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-client-boot-starter-docs.html) - 客户端配置与使用指南\n    *   [MCP服务器启动器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-server-boot-starter-docs.html) - 服务器设置与配置\n        *   [STDIO与SSE服务器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-stdio-sse-server-boot-starter-docs.html) - 传统传输机制\n        *   [可流式HTTP服务器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-streamable-http-server-boot-starter-docs.html) - 基于HTTP的现代传输\n        *   [无状态可流式HTTP服务器](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-stateless-server-boot-starter-docs.html) - 云原生部署选项\n*   [Spring AI MCP Java注解](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-annotations-overview.html) - 在Java中为MCP服务器和客户端提供基于注解的方法处理\n    *   [客户端注解](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-annotations-client.html) - 使用Java注解实现MCP客户端处理器的声明式方法\n    *   [服务器注解](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-annotations-server.html) - 使用Java注解实现MCP服务器功能的声明式方法\n    *   [特殊参数](https://docs.spring.io/spring-ai/reference/1.1-SNAPSHOT/api/mcp/mcp-annotations-special-params.html) - 为注解方法提供额外上下文和功能的特殊参数类型\n\n---\n\n_有关最新更新和完整文档，请访问[Spring AI参考文档](https://docs.spring.io/spring-ai/reference/)。_\n\n获取Spring新闻通讯\n-------------------------\n通过Spring新闻通讯保持联系\n\n[订阅](https://go-vmware.broadcom.com/tnz-spring-newsletter-subscribe)\n\n![](https://spring.io/img/extra/footer.svg)\n\n领先一步\n---------\nVMware提供培训和认证以加速您的进步。\n\n[了解更多](https://spring.academy/)\n\n获取支持\n-----------\nTanzu Spring在一个简单的订阅中提供对OpenJDK™、Spring和Apache Tomcat®的支持和二进制文件。\n\n[了解更多](https://spring.io/support)\n\n即将举行的活动\n---------------\n查看Spring社区所有即将举行的活动。\n\n[查看全部](https://spring.io/events)\n\n[](https://spring.io/blog/2025/09/16/spring-ai-mcp-intro-blog#header)\n\nCookie设置\n-------\n点击\"全部允许\"，即表示您理解Broadcom及第三方合作伙伴使用技术（包括Cookie）查看和保留您的网站互动、改善体验并帮助我们进行广告宣传。更多详情请参见我们的[Cookie通知](https://www.broadcom.com/company/legal/cookie-policy)。\n\n允许全部\n不出售或共享我的个人信息\nCookie设置\n\n![公司标志](https://cdn.cookielaw.org/logos/8153b982-ae11-46a0-b7c2-6e4e3b591d72/b2b73549-dd48-4805-83af-94b66f64fe57/d4a96bff-e4ff-44f4-a5af-efee8da0e3f9/Broadcom_Logo_Red-Black_no-tag.png)\n\n隐私偏好中心\n-------------------------\n隐私偏好中心\n-------------------------\n\n*   ### 您的隐私\n    \n*   ### 必要Cookie\n    \n*   ### 出售或共享个人数据\n    \n\n#### 您的隐私\n当您通过访问任何网站与Broadcom互动（如隐私政策所述）时，网站可能在浏览器上存储或检索信息，主要形式为Cookie。这些信息可能与您、您的偏好或设备相关，主要用于使网站按预期工作。信息通常不会直接识别您，但能提供更个性化的网络体验。\n[Cookie政策](https://www.broadcom.com/company/legal/cookie-policy)\n[隐私政策](https://www.broadcom.com/company/legal/privacy/policy)\n\n#### 必要Cookie\n始终启用\n这些Cookie对网站功能是必需的，无法在Broadcom系统中关闭。它们通常仅在您发起服务请求的操作时设置，如设置隐私偏好、登录或填写表单。您可将浏览器设置为阻止或提醒这些Cookie，但部分网站功能将无法工作。这些Cookie不存储任何个人身份信息。\n\n#### 出售或共享个人数据\n 出售或共享个人数据\n根据加州法律，某些Cookie使用可能被视为\"出售\"或\"共享\"个人信息。您可通过选择退出这些Cookie来拒绝此类\"出售\"或\"共享\"。\n\n*   ##### 定向Cookie\n     切换标签 label\n    这些Cookie可能通过Broadcom网站由其广告合作伙伴设置。这些公司可能用于构建您的兴趣档案并在其他网站展示相关广告。它们不直接存储个人信息，而是基于唯一识别您的浏览器和网络设备。若不允许这些Cookie，您将体验更少定向广告。\n    \n\n*   ##### 性能Cookie\n     切换标签 label\n    这些Cookie允许Broadcom统计访问量和流量来源以衡量和改进其网站性能。它们帮助Broadcom了解最受欢迎和最不受欢迎的页面，并查看访问者如何在网站中移动。这些Cookie收集的所有信息均为汇总且匿名。若不允许这些Cookie，Broadcom将无法了解您何时访问网站且无法监控其性能。\n    \n\n返回按钮\n\n### Cookie列表\n\n筛选按钮\n\n同意 法律利益\n\n 复选框标签 label\n\n 复选框标签 label\n\n 复选框标签 label\n\n清除\n\n*    复选框标签 label\n    \n\n应用 取消\n\n确认我的选择\n\n仅必需项 允许全部

## 1. 前言

唯一不变的是变化，在拥抱它前，请事先探知、归因、并充分准备。在相对完善的指标体系建设背景下，我们需要通过指标以及指标波动的解读来描述、追踪、推动业务。当一个指标波动时，我们首先需要从业务视角判断其波动是否异常，即异动检测，其次判断异常背后的原因是什么，即异动归因。

归因的方法有多种，这篇文章的重点是指标拆解，也是我们做业务分析时最常用到的方法。我们的目的是解放人力，将指标拆解实现**自动化**，一方面可以加快业务迭代速度，**快速定位问题**；另一方面可以对可能产生异动的维度进行**全局量化**，增强可比性，明确下一步的业务行动点的优先级。自动化异变归因的目的是为了尽快判断并抓住机遇，寻求以数据驱动作为灯塔指引业务航向。

## 2. 目的

将目标指标定义为$Y$， 波动为$\bigtriangleup Y \% = \frac{Y^1-Y^0}{Y^0}$,其中$Y^1$是当月的数据，$Y^0$为上个月（同比/环比）的数据。 文章目的是为了研究组成$Y$的集合$\{X\}$对于$\bigtriangleup Y \%$的贡献：

$\bigtriangleup Y \% = C_{X_1} + C_{X_2} + C_{X_3} + ...$

其中，$C_{X_i}$表示维度$X_i$对于$\bigtriangleup Y \%$的贡献度。 另外，**贡献的拆解算法**是根据组合方式不同决定，集合$\{X\}$组成$Y$的方式包括：

- 加法：$Y = X_1 + X_2 + X_3$（例，各渠道 uv 加和 ）

- 乘法：$Y = X_1 \cdot X_2 \cdot X_3$（例，已知 rpm=cpc*ctr 下，算出 cpc、ctr 分别对 rpm 的贡献）

- 比率型：$Y = \frac{P}{S}=\frac{\sum P_{X_i}}{\sum S_{X_i}}$（例，各广告计划的cpf, 或者各个渠道的cpuv等）

## 3. 贡献率的拆解方法

### 3.1  加法拆解

已知 $Y = \sum\limits_i X_i$，目标波动  $\bigtriangleup Y \% = \frac{Y^1-Y^0}{Y^0}$，贡献等于 $C_{X_i} = \frac{X_i^1 - X_i^0}{Y^0} = \frac{\bigtriangleup X_i}{Y^0}$，证明见附录。

举例针对绝对值指标的维度拆解都是加法拆解。绝对量指标的同比/环比变化，就是各个分指标变化的加权求和，例如访问uv总和等于各渠道uv加总， 那么总uv的变化下钻贡献率等于各渠道分别的变化除以上个月的总uv数。

### 3.2 乘法拆解



已知  $Y = \prod\limits_i X_i$，目标波动  $\bigtriangleup Y \% = \frac{Y^1-Y^0}{Y^0}$，贡献等于$C_{X_i} = \frac{L(Y^1,Y^0)\cdot\ln(\frac{X^1}{X^0})}{Y^0}$, 证明见附录。

其中 $X^1$是当月的数据， $X^0$ 为上个月的数据, $L(Y^1,Y^0)$为平均对数权重: 



$$
L(Y^1,Y^0)=\frac{Y^1-Y^0}{\ln(Y^1)-\ln(Y^0)}=\frac{\bigtriangleup Y}{\ln(Y^1)-\ln(Y^0)}
$$



以漏斗模型举例，借助用户动线，拆解指标。以全站商品详情页的浏览量（ipv）为例，其变动涉及流量、承接页到商品详情页的转化（uv-d转化）、商品详情页用户人均浏览量（人均pv），分别对应了用户增长、搜推场景承接以及私域用户活跃度等业务域或用户行为指标。借此对全站ipv的构成链路进行静态乘法拆解： 

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2EvpOkUjZzWzW8zJwCnNlsfBouibulN6A269h5G3s3hYmND970vTribRfg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

同时，我们可以计算各乘积因子对目标指标变化的贡献率$C_{X_i}$，衡量3个指标的重要性：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2Eic5eicHqiapcw8NyYR2z08Xu0iasdD9dmvUY8jvREv8qKcfxW9bxAU3zXA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

$L(ipv^1, ipv^0)$是平均对数权重，

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2EN5SF7swSTkc0v5nDV1DXIru4rX0AJBKP6CBfA0ADiaMtmSRzXcQ3zvQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



### 3.3 比率型指标拆解

已知 $Y=\frac{S}{P}=\frac{\sum\limits_i S_{X_i}}{\sum\limits_i P_{X_i}}$, $P_i=\frac{P_{X_i}}{\sum\limits_i P_{X_i}}$，$S_i=\frac{S_{X_i}}{\sum\limits_i S_{X_i}}$，$Y_i=\frac{S_{X_i}}{P_{X_i}}$

当分析比率指标进行维度下钻，分项对整体的贡献，受两个因素影响

- 分项的相对数指标波动贡献 ，即当期与基期的分项规模一致时，分项指标带来的变化：

分项的指标波动贡献 $A_{X_i} = 指标同比变化值 * 上期基数占比$

- 分项的结构变化 ，即当期与基期分项规模变化部分的指标变化：分项的结构变化 $B_{X_i}= 占比同比变化值 * （分项本期指标 - 整体上期指标 ）$



$$
A_{X_i}={(Y_i^1-Y_i^0)} \times {P_i^0} 
$$

$$
B_{X_i}={(P_i^1-P_i^0)} \times {(Y_i^1-Y^0)}
$$

$$
C_{X_i}=\frac{A_{X_i}+B_{X_i}}{Y^0}
$$



其中$Y_i^1$是当月的数据，$Y_i^0$为上个月的数据。



以承接页到商品详情页的转化率（uv-d转化率rate）为例，$rate=\frac{duv}{uv}$，流量渠道可分为付费、免费、自然、其他，每种渠道的uv-d转化率为 $rate_i=\frac{duv_i}{uv_i}$ 表示，各渠道的商详页访问人数（duv）占比用 $DUV_i=\frac{duv_i}{duv}$，各渠道人数（uv）占比用$UV_i=\frac{duv_i}{uv_i}$,如果 uv-d 转化率同比下跌，我们想定位出哪个渠道出现了问题；各渠道的贡献 $C_i$是怎么样计算为：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2ERI4q62vZgdicWbEIJLG8F1geDgEE0n6sk3VTXIXln55xrNVWcWGyuSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

## 

## 4. 实例应用

根据上文提到的不同指标的计算方法，支持全类型指标下钻求贡献的场景， 可根据先验业务输入搭建多层的归因逻辑模型， 层层下钻，最终将指标波动定位。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2Eb455UZFDwKoQicBkIUmowCCtoTpRMXQQthVvGMem1kkY9RFASgvMlYA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

>  图二：计算贡献率之后的数据结果样式



以2011年某日ipv同比下跌的异动分析为例：



第一层拆解，借助用户动线，将存在异动变化的指标ipv构成链路进行乘法拆解，如下：

$$
ipv=uv \times \frac{duv}{uv} \times \frac{ipv}{duv} = uv \times (uv - d转换率) \times (人均ipv)
$$



这里帮助我们定位到可能导致指标异动的关键节点，这有助于我们将问题定位到具体业务域，例如是uv的问题，转化的问题，还是人均ipv的问题？  



第二层拆解，对关键节点处的多个维度进行下钻，将问题定位到某些维度的某些水平上，同时避免陷入辛普森悖论等陷阱，这有助于我们形成具体业务域有所行动， 例如如果是转化的问题，究竟是哪个渠道的转化减少了？下图“异动分析拆解流程图”是根据先验的业务输入搭建的归因模型，根据其框架得以进行贡献率拆解与问题定位：

![图片](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naJib9YXogjVkglCgcPpx1l2EnyGRThzZRjYcutIPvD6aVXfAElpLBfhibVBk9QCaC2q9ibwqwoVic1wsg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

> 图三：指标拆解逐层归因

红色表示的链路指标或维度代表对总值下跌贡献率较大，经过一层一层的拆解定位到app端自然流量中转化的降低导致总转化下降。 基于流量跨端调控以及流量预算减投的业务背景，我们现将对ipv贡献最大的uv/duv根据端型、流量渠道类型、流量渠道、国家四个维度进行贡献率拆解。



在本实例中，通过本文对贡献率拆解方法与业务人工看数得到的问题定位基本一致，该方法可以实现异动贡献率量化与提效的目的，具体核心结论如下：

- 结论一 （第一层拆解）ipv下降主要影响因素是uv-d转化率的波动。 

- 结论二 （第二层拆解）uv-d比率的波动主要由APP端与WAP端导致，两种端型贡献持平。 

- 结论三 （第三/四层拆解）APP端的自然流量和wap端的付费流量是uv-d总比率波动的主要贡献维度。

- 结论四 （第五层拆解）APP端self-visit中美国对uv-d比率的波动贡献较大。

通过建立多层归因下钻维度模型， 用自动化的方式层层剥析，从而能尽求完善且正确的归因到某个维度，从而节省人力，提高准确和科学性。

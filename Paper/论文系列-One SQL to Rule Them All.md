
## 1. 前言

实时数据分析和管理对于当今的企业来说越来越重要。SQL 是这些努力的事实上的通用语言，但使用 SQL 进行流分析和管理仍然非常有限。许多方法将语义限制为减少的特征子集和/或需要一套非标准构造。此外，使用事件时间戳为根据事件实际发生的时间分析事件提供本地支持并不普遍，并且通常具有重要的限制。
我们提出了一个将流与标准 SQL 集成的三个提议：
- 时变关系作为传统 Table 和流数据的基础
- 事件时间语义
- 一组有限的可选扩展关键字来控制时变查询结果的物化。

我们从 Apache Calcite、Apache Flink 和 Apache Beam 中的实现中学到的示例和经验教训进行激励和说明，展示了如何通过最少的附加功能，利用完整的标准 SQL 语义来执行强大的流处理。

本文的论点是，在大型开源实时处理框架开发经验的支持下，SQL 语言和关系模型，按原样和少量非侵入式扩展，可以非常有效地处理流数据。我们的动机有两个：
- 首先，我们想分享我们在广泛使用的开源框架中进行流处理时的观察、创新和经验教训。
- 其次，我们希望将我们与国际 SQL 标准化机构 [26] 发起的工作通知更广泛的数据库社区，以标准化流式 SQL 功能和扩展，并促进关于该主题的全球对话

### 1.1 One SQL for Tables and Streams

以一致的方式使用相同的 SQL 语义是统一这流和表数据模式的一种高效且优雅的方式：简化了学习，简化了采用，并支持开发有凝聚力的数据管理系统。因此，我们的方法是提出一种统一的方法使用相同的语义来管理表和流。

### 1.2 Proposed Contribution

基于从现有技术和我们自己的工作中获得的见解：
- Time-varying Relations：首先，我们提出时变关系是 SQL、经典的时间点查询、不断更新的视图以及新颖的流式查询的共同基础。时变关系正如它表面看起来的一样：随时间变化的关系，也可以认为是一个函数，将每个时间点与一个静态关系进行映射。至关重要的是，现有的全套 SQL 运算符在时变关系上仍然有效，以最小的认知开销提供最大的功能。 3.1 详细描叙；6.2 中讨论与标准 SQL 的关系。
- 事件时间语义：其次，我们提出了一个建议是启用健壮的事件时间流语义。我们提出的扩展保留了所有现有的 SQL 语义并且非常适合。通过利用时变关系作为底层原始概念，我们可以自由地结合经典 SQL 和事件时间扩展。 第 3.2 节描述了必要的基础，第 6.2-6.4 节描述了我们提出的支持事件时间的扩展。
- 物化控制：第三，我们提出了一组适度的物化控制，为处理现代流用例的广度提供必要的灵活性
  - 流物化：为了完成流表对偶性，我们建议允许选择性地将查询输出呈现为对输出关系的变更流。这个流本身就是一个时变关系，流式 SQL 可以应用于表达用于区分流和表的系统的流方面的用例。3.3.1 节概括地描述了流实现，6.5.1 节描述了我们将流实现添加到 SQL 的建议。
  - 物化延迟：最后，我们提出了一个最小但灵活的框架，用于延迟时变关系中不完整的推测结果的物化。我们的框架在即时更新的视图语义之外增加了表现力以支持推送语义以及大容量用例。

总而言之，我们相信这些贡献为在流式上下文中充分利用标准 SQL 奠定了坚实的基础，同时为经典时间点查询上下文中的健壮事件时间处理提供了额外的功能。

## 2. 背景及相关工作

### 2.1 Streaming SQL 历史

### 2.2 现在流式系统

## 3. 流式 SQL 基础

我们对流式 SQL 的提议分为两部分。在本节中是第一部分：基础概念，列出了支持流操作的基础概念和实现技术。第二部分是在第 6 节中，建立在这些基础之上，确定标准 SQL 已经支持流式传输的方式，并提出对 SQL 的最小扩展，以便为其余概念提供强大的支持。中间部分致力于通过示例和从我们的开源框架中吸取的经验教训来讨论基础。

### 3.1 Time-Varying Relations

在流上下文中，要考虑的其他关键维度就是时间。在处理传统关系时，只需要在单时间点处理关系即可。但在处理流式关系时，必须处理随着时间演变的关系。我们建议明确说明 SQL 在时变关系或 TVR 上运行。

时变关系顾名思义：一种随时间变化的关系。



### 3.2 Event Time 语义

### 3.3 物化控制

## 4. 例子

## 5. 实践中的经验教训

## 6. 扩展 SQL 标准

### 6.1 SQL 中对流式处理的现有支持

### 6.2 Time-Varying Relations, Event Time Columns, and Watermarks

### 6.3 事件时间戳上的分组

### 6.4 Event-Time Windowing Functions

### 6.5 Materialization Controls

## 7. 结论

## 8. 未来工作
